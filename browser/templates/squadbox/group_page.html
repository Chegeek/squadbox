{% extends "squadbox/base.html" %}
{% block customcss %}
	<link href="/static/css/third-party/datatable.css" rel="stylesheet">
{% endblock %}
{% block content %}
	<div class="container">
		<div class="group-container">
			
			{% if group_info.admin %}
				<span class="admin label">Admin</span>
			{% else %}
				<span class="admin label" style="display: none;"></span>
			{% endif %}
			
			{% if group_info.moderator %}
				<span class="mod label">Mod</span>
			{% else %}
				<span class="mod label" style="display: none;"></span>
			{% endif %}
			
			<h3><span id="group-name">{{ group_info.group.name }}</span></h3>
			<hr/>
			{% if group_info.group.description == "" %}
				<span class="italic-med">No description</span>
			{% else %}
				<span class="italic-med">{{ group_info.group.description }}</span>
			{% endif %}
			
			<br><br>
			
			{% if group_info.admin %}
				{% if not group_info.group.allow_attachments %}
					<span class="strong">No Attachments</span> are allowed.
				{% else %}
					Attachments <span class="strong">are allowed</span>.
				{% endif %}

				<br>
				{% if not group_info.group.send_rejected_tagged %}
					Rejected messages <span class="strong">will not</span> be sent to your inbox.
				{% else %}
					Rejected messages <span class="strong">will</span> be sent to your inbox with a [rejected] tag.
				{% endif %}
				<br>
				{% if not group_info.group.show_rejected_site %}
					Rejected messages <span class="strong">will not</span> be stored or displayed on this site.
				{% else %}
					Rejected messages <span class="strong">will</span> be stored and displayed to you on this site.
				{% endif %}
				<br><br>
			{% endif %}
			
			<div id="group-options">
				{% if group_info.subscribed %}
					<!-- 						<button type="button" id="btn-edit-settings">Edit My Settings</button> -->
					{% if group_info.admin %}
						<button type="button" id="btn-edit-group-info">Edit settings</button>
					{% endif %}
					<br /><br />
				{% else %}
					<button type="button" id="btn-edit-settings" style="display: none;">Edit My Settings</button>
				{% endif %}
				
				{% if group_info.subscribed and not group_info.admin %}
					<button type="button" id="btn-unsubscribe-group">Leave squad</button>
				{% endif %}
			</div>
			
			<hr />
			{% if group_info.admin %}
				<h3>Squad Members</h3>
				<button type="button" id="btn-add-members">Invite new moderators</button>
				<button type="button" id="btn-del-members">Remove selected</button>
			{% else %}
				<button type="button" id="btn-add-members" style="display: none;">Add Members</button>
			{% endif %}
			{% if group_info.admin %}
				<table id="members-table" class="display" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Select</th>
							<th>Email</th>
							{% if flavour != "mobile" %}
								<th>Joined</th>
								<th>Admin</th>
								<th>Moderator</th>
							{% endif %}
						</tr>
					</thead>
					
					<tfoot>
					<tr>
						<th>Select</th>
						<th>Email</th>
						{% if flavour != "mobile" %}
							<th>Joined</th>
							<th>Admin</th>
							<th>Moderator</th>
						{% endif %}
					</tr>
					</tfoot>
					
					<tbody>
						{% for member in group_info.members %}
							
							{% if member.email == user.email %}
								<tr class="my_row">
								{% else %}
									<tr>
									{% endif %}
									
									{% if group_info.admin %}
										<td><input class="checkbox checkbox-user" type="checkbox" id ={{ member.id }}></td>
										<td>{{ member.email }}</td>
										{% if flavour != "mobile" %}
											<td>{{ member.joined }}</td>
											{% if member.admin %}
												<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
											{% else %}
												<th></th>
											{% endif %}
											{% if member.mod %}
												<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
											{% else %}
												<th></th>
											{% endif %}
										{% endif %}
									</tr>
								{% else %}
									<td>{{ member.email }}</td>
									{% if flavour != "mobile" %}
										<td>{{ member.joined }}</td>
										{% if member.admin %}
											<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
										{% else %}
											<th></th>
										{% endif %}
										{% if member.mod %}
											<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
										{% else %}
											<th></th>
										{% endif %}
									{% endif %}
								</tr>
							{% endif %}
						{% endfor %}
						{% for member in group_info.members_pending %}
							<tr>
								<td></td>
								<td><i>{{ member.email }} (pending)</i></td>
								{% if flavour != "mobile" %}
									<td>{{ member.joined }}</td>
									{% if member.admin %}
										<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
									{% else %}
										<th></th>
									{% endif %}
									{% if member.mod %}
										<th><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></th>
									{% else %}
										<th></th>
									{% endif %}
								{% endif %}
							</tr>
						{% endfor %}
					</tbody>
				</table>
				<br />
				<hr>
				<h3>Whitelist/Blacklist</h3>
				<a href='/gmail_setup?group={{group_info.name}}'>Setup automatic forwarding and import Gmail contacts to this squad's whitelist &raquo;</a>
				<hr>
				{% if group_info.admin %}
					<div style="text-align:center">
						<button type="button" class="btn btn-danger" id="btn-delete-group">Delete squad</button>
					</div>
				{% endif %}
			</div>
		</div>
	{% endif %}
{% endblock %}
{% block customjs %}
	<script type="text/javascript" src="/static/javascript/squadbox/group_page.js"></script>
{% endblock %}